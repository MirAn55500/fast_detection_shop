# Object Detection Service

Веб-приложение для обнаружения объектов в видео с использованием алгоритма YOLO (You Only Look Once). Система способна обнаруживать людей, паллеты и купола (при использовании пользовательской модели) в видео и сохранять результаты.

## Функциональность

- Загрузка видео через веб-интерфейс
- Выбор между стандартной моделью (только определение людей) и пользовательской моделью (люди, паллеты, купола)
- Обработка видео с пониженной частотой кадров для повышения производительности
- Визуализация прогресса обработки в реальном времени
- Вывод статистики и результатов обнаружения объектов
- Отображение исходного и обработанного видео
- Сохранение кадров событий для детального анализа

## Установка и запуск

### С использованием Docker (рекомендуется)

1. Клонировать репозиторий:
   ```
   git clone https://github.com/MirAn55500/fast_detection_shop.git
   cd fast_detection_shop
   ```

2. Запустить с помощью Docker Compose:
   ```
   docker-compose up -d
   ```
   
   Или с использованием Makefile:
   ```
   make up
   ```

3. Открыть в браузере: http://localhost:8000

Для остановки сервиса:
   ```
   docker-compose down
   ```
   
   Или с использованием Makefile:
   ```
   make down
   ```

#### Быстрая проверка Docker-установки

Для проверки корректности установки Docker и запуска сервиса можно использовать скрипт:
   ```
   python docker-check.py
   ```
   
   Или с использованием Makefile:
   ```
   make check
   ```

Скрипт проверит:
- Наличие Docker и Docker Compose
- Работу сервиса на http://localhost:8000
- При необходимости запустит сервис и откроет его в браузере

### Ручная установка

1. Клонировать репозиторий:
   ```
   git clone https://github.com/MirAn55500/fast_detection_shop.git
   cd fast_detection_shop
   ```

2. Создать виртуальную среду Python и активировать её:
   ```
   python -m venv venv
   # Windows:
   venv\Scripts\activate
   # Linux/Mac:
   source venv/bin/activate
   ```

3. Установить зависимости:
   ```
   pip install -r requirements.txt
   ```

4. Запустить приложение:
   ```
   python app.py
   ```

5. Открыть в браузере: http://localhost:8000

## Структура проекта

- `app.py` - FastAPI приложение и маршруты
- `person_detection_service.py` - Основной сервис обнаружения объектов
- `templates/` - HTML шаблоны для веб-интерфейса
- `static/` - Статические файлы и загруженные видео
- `models/` - Директория для моделей YOLO
- `custom_model_training.py` - Скрипт для обучения пользовательской модели
- `dataset_preparation_guide.md` - Руководство по подготовке датасета для обучения
- `Dockerfile` - Инструкции для сборки Docker образа
- `docker-compose.yml` - Конфигурация для запуска в Docker
- `docker-check.py` - Скрипт для проверки Docker-установки
- `Makefile` - Упрощение работы с Docker-командами

## Docker

Проект содержит конфигурацию Docker для простого развертывания:

1. `Dockerfile` - определяет образ приложения на основе Python 3.9 с установленными зависимостями
2. `docker-compose.yml` - настраивает контейнер и создает тома для хранения данных
3. `.dockerignore` - указывает файлы, которые не должны включаться в образ

Преимущества использования Docker:
- Изоляция от системных зависимостей
- Простое развертывание на любой платформе с Docker
- Постоянство данных через тома (модели, загруженные видео и результаты)

### Makefile

Для упрощения работы с Docker предоставляется Makefile со следующими командами:

| Команда | Описание |
|---------|----------|
| `make build` | Собрать Docker-образ |
| `make up` | Запустить сервис |
| `make down` | Остановить сервис |
| `make logs` | Показать логи сервиса |
| `make ps` | Показать статус контейнера |
| `make check` | Запустить скрипт проверки Docker-установки |
| `make clean` | Удалить временные файлы и очистить кэш |
| `make help` | Показать справку по командам |

## Кастомизация модели

Для обучения пользовательской модели для обнаружения специфических объектов:

1. Подготовьте датасет в соответствии с `dataset_preparation_guide.md`
2. Запустите скрипт обучения:
   ```
   # Для локальной установки:
   python custom_model_training.py
   
   # Для Docker:
   docker-compose exec person-detection-service python custom_model_training.py
   ```

## Технические детали

- Фреймворк: FastAPI
- Алгоритм обнаружения: YOLOv4-tiny
- Обработка видео: OpenCV
- Частота кадров: 1 кадр из 16 (регулируемая)
- Формат вывода: MP4/AVI с поддержкой разных кодеков
- Поддержка клиентских устройств: адаптивный дизайн
- Контейнеризация: Docker и Docker Compose

## Требования

- Docker и Docker Compose (для запуска через Docker)

Для ручной установки:
- Python 3.8 или выше
- OpenCV 4.x
- Зависимости в requirements.txt
